var RB={};
RB.Scene=function(c,j){if(!c)throw"RB.Scene(canvasObject): You must specify a canvas object";j||(j=24);this.timeInterval=j;var l=document;this.ctx=c.getContext("2d");var d=[],k=null,s=!1,x=!1,q=!1,m=!1,t=!1,r=null,y=0,i=0,n=[],p=[],u=!1,v=0,a=0;this.add=function(b){if(!b)throw"RB.Scene.add(o): the object you are trying to add to the scene doesn't exist.";d.push(b);b.collidable&&n.push(b);b.draggable&&p.push(b);return b};this.addLots=function(b){for(var a=0;a<b.length;a++)this.add(b[a])};this.remove=
function(b){for(var b=b.getId(),a=d.length,e=p.length,g=n.length,f=0;f<a;f++)if(b==d[f].getId()){d.splice(f,1);break}for(f=0;f<g;f++)if(b==n[f].getId()){n.splice(f,1);break}for(f=0;f<e;f++)if(b==p[f].getId()){p.splice(f,1);break}};this.removeLots=function(b){for(var a=0;a<b.length;a++)this.remove(b[a])};this.removeAll=function(){var b=p.length,a=n.length;d.splice(0,d.length);n.splice(0,a);p.splice(0,b)};this.zIndex=function(b,a){var e=d.length,g=getIdByObject(b),f=g+a;f<0&&(f=0);f>=e&&(f=e-1);e=d[g];
d[g]=d[f];d[f]=e};getObjectById=function(b){for(var a=d.length,e=0;e<a;e++)if(d[e].getId()==b)return o;return null};getIdByObject=function(b){for(var a=d.length,e=0;e<a;e++)if(d[e].getId()==b.getId())return e;return null};this.setMovableObject=function(b){k=typeof b=="object"?b.getId():b};this.getMovableObject=function(){return getObjectById(k)};var w=function(b,a){switch(b.keyCode){case 37:s=a;break;case 38:q=a;break;case 39:x=a;break;case 40:m=a}};this.onmousemove=function(){};this.onmousedown=
function(){};this.onmouseup=function(){};this.onkeydown=function(){};this.onkeyup=function(){};var h=this;c.onmousemove=function(b){if(t&&r)r.x=RB.xPos(b)-y,r.y=RB.yPos(b)-i,u||h.update();h.onmousemove(b)};c.onmousedown=function(b){for(var a=p.length-1;a>=0;a--){var e=p[a];if(e.checkRange(RB.xPos(b),RB.yPos(b))){r=e;currentObjectIndex=a;y=RB.xPos(b)-r.x;i=RB.yPos(b)-r.y;t=!0;break}}h.onmousedown(b)};c.onmouseup=function(b){t=!1;h.onmouseup(b)};l.onkeydown=function(b){w(b,!0);h.onkeydown(b)};l.onkeyup=
function(b){w(b,!1);h.onkeyup(b)};this.getObjectSize=function(){return d.length};this.getObj=function(b){return d[b]};this.rect=function(b,a,e,g){var g=RB.createCanvas(b,a,g),f=g.getContext("2d");f.fillStyle=RB.getFS(e,f,a);f.fillRect(0,0,b,a);return g};this.image=function(b,c){var e=new Image,g=this,f=null;e.onload=function(){f=RB.createCanvas(e.width,e.height,c);f.getContext("2d").drawImage(this,0,0);a++;a==v&&g.doAfterLoad()};e.src=b;v++};this.imagePattern=function(b,c,e,g,f){var z=new Image,d=
this;z.onload=function(){var b=RB.createCanvas(c,e,f).getContext("2d"),h=b.createPattern(z,g);b.fillStyle=h;b.fillRect(0,0,c,e);a++;a==v&&d.doAfterLoad()};z.src=b;v++};this.roundRect=function(b,a,e,g,f){if(!b||!a||!e||!g||!f)throw"All parameters must be set: roundRect(w, h, arc, fillStyle, id);";var f=RB.createCanvas(b,a,f),c=f.getContext("2d");c.beginPath();c.moveTo(0+e,0);c.lineTo(b+0-e,0);c.quadraticCurveTo(b+0,0,b+0,0+e);c.lineTo(b+0,a+0-e);c.quadraticCurveTo(b+0,0+a,b+0-e,0+a);c.lineTo(0+e,0+
a);c.quadraticCurveTo(0,0+a,0,0+a-e);c.lineTo(0,0+e);c.quadraticCurveTo(0,0,0+e,0);c.closePath();c.fillStyle=RB.getFS(g,c,a);c.fill();return f};this.text=function(a,c,e,g,f){var d=RB.getTextBuffer();d.innerHTML=a;d.style.fontFamily=c;d.style.fontSize=e+"px";var h=RB.el(f);h?(f=h.getContext("2d"),h.width=d.offsetWidth,h.height=d.offsetHeight+15,f.clearRect(0,0,d.offsetWidth,d.offsetHeight+15)):(h=RB.createCanvas(d.offsetWidth,d.offsetHeight+15,f),f=h.getContext("2d"));f.fillStyle=RB.getFS(g,f,d.offsetHeight+
25);f.font="normal "+e+"px "+c;f.fillText(a,0,d.offsetHeight+5);return h};this.start=function(){u=!0;this.animate()};this.stop=function(){u=!1};this.toggleStart=function(){u?this.stop():this.start()};this.onLoop=function(){};this.runOnce=function(){for(var a=d.length,c=n.length,e=0;e<a;e++){var g=d[e];if(g.visible){g.run();if(g.collidable&&!g.obstacle)for(var f=0;f<c;f++){var h=n[f];if(g.getId()!=h.getId())if(h=g.checkCollision(h,!0),h.top||h.bottom||h.left||h.right){g.colliding=!0;g.collidingCoords=
h;break}else g.colliding=!1,g.collidingCoords=null}f=s||x||m||q;if(g.getId()==k&&f){var i=h=f=!1,j=!1,w=g.collidingCoords;if(w)f=w.left,h=w.right,i=w.top,j=w.bottom;s&&!f&&g.left();x&&!h&&g.right();q&&!i&&g.up();m&&!j&&g.down()}}}};this.animate=function(){this.runOnce();this.onLoop();if(u){var a=this;setTimeout(function(){a.animate()},this.timeInterval)}};this.update=function(){for(var a=d.length,c=0;c<a;c++)d[c].run()};this.doAfterLoad=function(){}};
RB.Obj=function(c,j,l,d){if(!j)throw"RB.Obj(c, sceneContext, _x, _y): You must specify a scene context";var k=Math.random(),s=j,x=null,q=null;this.h=this.w=this.y=this.x=0;if(l)this.x=l;if(d)this.y=d;this.visible=!0;this.colliding=this.obstacle=this.collidable=!1;var m=this.collidingCoords=null;this.draggable=!1;this.speedY=this.speedX=1;var t=null;this.spriteChangeInterval=1;var r=0,y=0;this.setCanvas=function(a){q=typeof a=="object"?a:RB.el(a);this.w=q.width;this.h=q.height};this.setCoords=function(a,
c){this.x=a;this.y=c};this.setDimension=function(a,c){this.w=a;this.h=c};this.setCanvas(c);this.getCanvas=function(){return q};this.getId=function(){return k};this.setSCtx=function(a){s=a};this.getSCtx=function(){return s};this.setCtx=function(a){x=a};this.getCtx=function(){return x};this.setXY=function(a,c){this.x=a;this.y=c};this.setSpeed=function(a){this.speedY=this.speedX=a};this.getX2=function(){return this.x+this.w};this.getY2=function(){return this.y+this.h};this.fn=function(){this.draw()};
this.run=function(){this.fn()};this.clone=function(){var a=new RB.Obj(c,s);a.x=this.x;a.y=this.y;a.w=this.w;a.h=this.h;a.collidable=this.collidable;a.obstacle=this.obstacle;a.fn=this.fn;a.speedX=this.speedX;a.speedY=this.speedY;a.setSprites(t,this.spriteChangeInterval);a.draggable=this.draggable;a.visible=this.visible;return a};this.draw=function(a,c){a&&c?s.drawImage(q,this.x,this.y,a,c):s.drawImage(q,this.x,this.y)};this.up=function(a){this.y-=a||this.speedY;m="up"};this.down=function(a){this.y+=
a||this.speedY;m="down"};this.left=function(a){this.x-=a||this.speedX;m="left"};this.right=function(a){this.x+=a||this.speedX;m="right"};this.setSprites=function(a,c){t=a;spriteChangeInterval=c};this.animateSprite=function(){r==spriteChangeInterval?(q=t[++y]?t[y]:t[y=0],r=0):r++};this.checkCollision=function(a,c){var h=a.x,b=a.y,d=a.getX2(),e=a.getY2();c&&(h-=this.speedX,b-=this.speedY,d+=this.speedX,e+=this.speedY);var g={top:!1,bottom:!1,left:!1,right:!1};if(m=="up")g.top=u(h,b,d,e),g.left=n(h,
b,d,e),g.right=p(h,b,d,e);if(m=="down")g.bottom=v(h,b,d,e),g.left=n(h,b,d,e),g.right=p(h,b,d,e);if(m=="right")g.right=p(h,b,d,e),g.top=u(h,b,d,e),g.bottom=v(h,b,d,e);if(m=="left")g.left=n(h,b,d,e),g.top=u(h,b,d,e),g.bottom=v(h,b,d,e);return g};var i=this,n=function(a,c,d,b){a=i.x<d&&i.x+i.w>d;return i.y<b&&i.y+i.h>c&&a},p=function(a,c,d,b){a=i.x+i.w>a&&i.x+i.w<d;return i.y<b&&i.y+i.h>c&&a},u=function(a,c,d,b){a=i.x<d&&i.x+i.w>a;return i.y<b&&i.y+i.h>b&&a},v=function(a,c,d,b){a=i.x<d&&i.x+i.w>a;return i.y+
i.h>c&&i.y+i.h<b&&a};this.checkRange=function(a,c){var d=c>=this.y&&c<=this.y+this.h;return a>=this.x&&a<=this.x+this.w&&d};this.onCollide=function(){};this.onNonCollide=function(){};this.boom=function(){this.onCollide()}};RB.createTextBuffer=function(){var c=document,j=c.createElement("div");j.id="txtBuffer";j.style.position="absolute";j.style.width="auto";j.style.height="auto";j.style.padding="0px";j.style.visibility="hidden";c.body.appendChild(j)};
RB.getTextBuffer=function(){RB.el("txtBuffer")||RB.createTextBuffer();return RB.el("txtBuffer")};RB.createCanvasLocation=null;RB.createCanvas=function(c,j,l){var d=document,k=d.createElement("canvas");k.width=c;k.height=j;k.id=l;k.style.display="none";RB.createCanvasLocation?RB.createCanvasLocation.appendChild(k):d.body.appendChild(k);return k};RB.destroyCanvas=function(c){var j=document,c=j.getElementById(c);j.body.removeChild(c)};RB.el=function(c){return document.getElementById(c)};
RB.linearGradient=function(c,j){var l=j.createLinearGradient(0,5,0,c.h);csLen=c.colors.length;for(var d=0;d<csLen;d++){var k=c.colors[d];l.addColorStop(k.stopPoint,k.name)}return l};RB.getFS=function(c,j,l){if(typeof c=="object")return c.h=l,RB.linearGradient(c,j);return c};RB.rtImage=function(c,j,l){var d=new Image;d.onload=function(){var c=RB.createCanvas(d.width,d.height,j);c.getContext("2d").drawImage(this,0,0);l&&l(c)};d.src=c};
RB.canvasSupport=function(c){if(c)try{return c.getContext("2d"),!0}catch(j){return!1}else return!1};RB.xPos=function(c){return c.pageX-c.target.offsetLeft};RB.yPos=function(c){return c.pageY-c.target.offsetTop};
